!function t(e,n,i){function s(o,a){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(r)return r(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return s(n?n:t)},l,l.exports,t,e,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(t){"use strict";var e=t("../components/auth/auth.service")["default"],n=t("../components/github/github.service")["default"],i=t("./login/login.controller")["default"],s=t("./main/main.controller")["default"],r=t("./profile/profile.controller")["default"],o=t("../components/navbar/navbar.directive")["default"],a=t("../components/handle/handle.directive")["default"],c=t("../components/preview/preview.directive")["default"];angular.module("gistter",["restangular","ui.router","ngMaterial","ui.ace","angularMoment"]).controller("LoginCtrl",i).controller("MainCtrl",s).controller("ProfileCtrl",r).directive("navbar",o.directiveFactory).directive("handle",a.directiveFactory).directive("preview",c.directiveFactory).service("Auth",e).service("GH",n.ghFactory).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,e,n){e.state("home",{url:"/editor/:gistId?",templateUrl:"app/main/main.html",controller:"MainCtrl as main"}).state("login",{url:"/login?code",templateUrl:"app/login/login.html",controller:"LoginCtrl as login"}).state("profile",{url:"/{user:[^/w[w-]+[/]$}",templateUrl:"app/profile/profile.html",controller:"ProfileCtrl as profile"}),n.otherwise("/editor/")}])},{"../components/auth/auth.service":5,"../components/github/github.service":6,"../components/handle/handle.directive":7,"../components/navbar/navbar.directive":8,"../components/preview/preview.directive":9,"./login/login.controller":2,"./main/main.controller":3,"./profile/profile.controller":4}],2:[function(t,e,n){"use strict";var i=function(t,e,n){t.isLogged()||t.getToken(e.code).then(function(t){sessionStorage.token=t,n.go("home")},function(t){t&&console.dir("Oops!")})};i.$inject=["Auth","$stateParams","$state"],n["default"]=i},{}],3:[function(t,e,n){"use strict";var i=function(){var t=function(t,e,n,i,s,r,o){var a=this;if(this.$scope=t,this.$state=e,this.$stateParams=n,this.$mdDialog=i,this.Auth=r,this.GH=o.getInstance(sessionStorage.token),this.desc="",s.get("app/main/editorTemplate.html").success(function(t){a.content={html:t,css:"",js:""}}),r.getUser().then(function(t){a.user=t}),n.gistId){var c=this.GH.getGist(n.gistId);c.read(function(e,n){a.gist=n,a.desc=n.description||"",a.content.html=n.files["index.html"]?n.files["index.html"].content:"",a.content.css=n.files["main.css"]?n.files["main.css"].content:"",a.content.js=n.files["app.js"]?n.files["app.js"].content:"",t.$apply()})}};return t.prototype.newGist=function(){this.$state.go("home",{gistId:""},{reload:!0})},t.prototype.save=function(){var t=this,e={};this.content.html&&(e["index.html"]={content:this.content.html}),this.content.css&&(e["main.css"]={content:this.content.css}),this.content.js&&(e["app.js"]={content:this.content.js}),""===this.$stateParams.gistId?this.GH.getGist().create({access_token:sessionStorage.token,description:this.desc||"Gistter: ","public":!0,files:e},function(e,n){console.dir(n),t.$state.go("home",{gistId:n.id})}):this.GH.getGist(this.$stateParams.gistId).update({access_token:sessionStorage.token,description:this.desc,files:e},function(t,e){console.dir(e)})},t.prototype.isNew=function(){return!this.gist},t.prototype.isOwner=function(){return!!this.gist&&!!this.$stateParams.gistId&&this.user&&this.gist.owner&&this.user.id===this.gist.owner.id},t.prototype.hasOwner=function(){return!!this.gist&&!!this.gist.owner},t.prototype.isForkeable=function(){return!!this.gist&&!!this.$stateParams.gistId&&this.user&&this.gist.owner&&this.user.id!==this.gist.owner.id},t.prototype.fork=function(){var t=this;this.GH.getGist(this.$stateParams.gistId).fork(function(e,n){console.dir(n),t.$state.go("home",{gistId:n.id})})},t.prototype.info=function(t){var e=this;this.$mdDialog.show({controller:function(t,e,n,i,s,r,o){t.desc=i.split("Gistter: ")[1],t.isOwner=s,t.hasOwner=r,t.isNew=o,t.hide=function(){e.hide()},t.cancel=function(){e.cancel()},t.update=function(t){e.hide(t)}},template:'\n        <md-dialog aria-label="Gist description">\n          <md-content>\n          <form name="userForm">\n              <md-input-container flex>\n                <label>Description</label>\n                <textarea ng-model="desc" columns="1" md-maxlength="500" ng-disabled="hasOwner && !isOwner && !isNew"></textarea>\n              </md-input-container>\n            </md-content>\n          </form>\n          <div class="md-actions" layout="row">\n            <md-button ng-click="cancel()">\n              Close\n            </md-button>\n            <md-button ng-click="update(desc)" class="md-primary" ng-if="!(hasOwner && !isOwner && !isNew)">\n              Save\n            </md-button>\n          </div>\n        </md-dialog>\n      ',targetEvent:t,locals:{desc:this.desc,isOwner:this.isOwner(),hasOwner:this.hasOwner(),isNew:this.isNew()}}).then(function(t){e.desc="Gistter: "+t,e.save()},function(){console.dir("You cancelled the dialog.")})},t}();i.$inject=["$scope","$state","$stateParams","$mdDialog","$http","Auth","GH"],n["default"]=i},{}],4:[function(t,e,n){"use strict";var i=function(){var t=function(t,e,n,i,s){var r=this;this.$scope=t,this.$state=e,this.$stateParams=n,this.Auth=i,this.GH=s.getInstance(sessionStorage.token),i.getUser().then(function(t){r.current_user=t});var o=n.user.substring(0,n.user.length-1);this.GH.getUser().show(o,function(e,n){r.user=n,t.$apply()}),this.GH.getUser().userGists(o,function(e,n){r.gists=_.filter(n,function(t){var e=t.description.split("Gistter: ");return e.length>1?(t.description=e[1],t):void 0}),t.$apply()})};return t.prototype.isOwner=function(t){return this.user&&this.user.id===t.owner.id},t.prototype.remove=function(t){var e=this;window.confirm("Do you really want to delete this gist?")&&this.GH.getGist(t)["delete"](function(n,i){i&&(e.gists.splice(_.findIndex(e.gists,{id:t}),1),e.$scope.$apply())})},t}();i.$inject=["$scope","$state","$stateParams","Auth","GH"],n["default"]=i},{}],5:[function(t,e,n){"use strict";var i=function(){var t=function(t,e,n,i){this.http=t,this.promise=e,this.$timeout=n,this.user,this.GH=i};return t.prototype.getToken=function(t){var e=this.promise.defer();return this.http.get("https://jlcarv-coder.herokuapp.com/authenticate/"+t).success(function(t){t.hasOwnProperty("error")?e.reject(t.error):e.resolve(t.token)}),e.promise},t.prototype.getUser=function(){var t=this,e=this.promise.defer();return this.isLogged()?angular.isDefined(this.user)?e.resolve(this.user):this.GH.getInstance(sessionStorage.token).getUser().show(!1,function(n,i){t.user=i,e.resolve(t.user)}):e.reject(!0),e.promise},t.prototype.isLogged=function(){return angular.isDefined(sessionStorage.token)?!0:void 0},t}();i.$inject=["$http","$q","$timeout","GH"],n["default"]=i},{}],6:[function(t,e,n){"use strict";var i=function(){var t=function(){};return t.prototype.getInstance=function(t){if(t){var e=new Github({token:t,auth:"oauth"});return e}return new Github({})},t.ghFactory=function(){return new t},t}();n["default"]=i},{}],7:[function(t,e,n){"use strict";var i=function(){var t=function(){this.template='<div class="handle"></div>',this.replace=!0,this.restrict="E"};return t.prototype.link=function(t,e){var n=$("body").css("cursor");$(e).on("mousedown",function(t){n=$("body").css("cursor"),$("body").css("cursor","col-resize");var e=$(this).addClass("draggable"),i=e.css("z-index"),s=e.outerWidth(),r=e.offset().left+s-t.pageX,o={mousemove:function(t){var n=e.prev(),i=e.next();e.css("z-index",9999),$(".drag-cover").show();var o=n.outerWidth()+i.outerWidth(),a=(t.pageX-n.offset().left+(r-s/2))/o,c=1-a;n.css("flex",a.toString()),i.css("flex",c.toString())},mouseup:function(){$("body").css("cursor",n),$(".drag-cover").hide(),$(".draggable").removeClass("draggable").css("z-index",i),$(this).off(o)}};$(document).on(o)})},t.directiveFactory=function(){return t.instance=new t,t.instance},t}();n["default"]=i},{}],8:[function(t,e,n){"use strict";var i=new WeakMap,s=new WeakMap,r=function(){var t=function(t,e){i.set(this,e),s.set(this,t),this.templateUrl="components/navbar/navbar.html",this.restrict="E",this.transclude=!0,this.controllerAs="navbar",this.bindToController=!0};return t.prototype.controller=function(){var e=this;this.Auth=i.get(t.instance),this.Auth.isLogged()&&s.get(t.instance)(function(){e.Auth.getUser().then(function(t){e.user=t})})},t.directiveFactory=function(e,n){return t.instance=new t(e,n),t.instance},t}();r.directiveFactory.$inject=["$timeout","Auth"],n["default"]=r},{}],9:[function(t,e,n){"use strict";var i=function(){var t=function(){this.template='<div ng-id="{{id}}" class="preview"><iframe id="{{id}}Iframe" allowfullscreen></iframe><div class="drag-cover"></div></div>',this.restrict="E",this.replace=!0,this.scope={id:"@",content:"="}};return t.prototype.link=function(t){t.$watch("content",function(e){if(angular.isDefined(t.id)&&angular.isDefined(e)){var n=e.html||"",i=e.css||"",s=e.js||"",r=n.replace('<link rel="stylesheet" type="text/css" href="main.css">',"<style>"+i+"</style>").replace('<script type="text/javascript" src="app.js"></script>',"<script>"+s+"</script>");document.getElementById(t.id+"Iframe").contentWindow.document.write(r),document.getElementById(t.id+"Iframe").contentWindow.document.close()}},!0)},t.directiveFactory=function(){return t.instance=new t,t.instance},t}();n["default"]=i},{}]},{},[1]),angular.module("gistter").run(["$templateCache",function(t){t.put("app/login/login.html",'<div class="loginPage" layout="row" layout-sm="column" layout-align="center center"><md-progress-circular md-mode="indeterminate"></md-progress-circular></div>'),t.put("app/main/editorTemplate.html",'<!doctype html><html lang="en"><head><meta charset="UTF-8"><title>Gistter</title><link rel="stylesheet" type="text/css" href="main.css"></head><body><script type="text/javascript" src="app.js"></script></body></html>'),t.put("app/main/main.html",'<div layout="column" layout-fill=""><navbar><md-button ng-click="main.newGist()" class="md-raised">New</md-button><md-button ng-click="main.save()" class="md-raised">Save</md-button><md-button ng-if="main.isForkeable()" ng-click="main.fork()" class="md-raised">Fork</md-button><md-button ng-click="main.info($event)" class="md-raised">Info</md-button></navbar><md-content class="fb"><md-tabs md-selected="0" class="md-primary techs" layout-align="space-around center"><md-tab id="tab1" label="HTML"><div ng-model="main.content.html" ui-ace="{ useWrapMode : true, theme:\'monokai\', mode: \'html\', require: [\'ace/ext/language_tools\'], advanced: { enableSnippets: true, enableBasicAutocompletion: true, enableLiveAutocompletion: true } }"></div></md-tab><md-tab id="tab2" label="CSS"><div ng-model="main.content.css" ui-ace="{ useWrapMode : true, theme:\'monokai\', mode: \'css\', require: [\'ace/ext/language_tools\'], advanced: { enableSnippets: true, enableBasicAutocompletion: true, enableLiveAutocompletion: true } }"></div></md-tab><md-tab id="tab3" label="JS"><div ng-model="main.content.js" ng-model-options="{ updateOn: \'default blur\', debounce: {\'default\': 500, \'blur\': 0} }" ui-ace="{ useWrapMode : true, theme:\'monokai\', mode: \'javascript\', require: [\'ace/ext/language_tools\'], advanced: { enableSnippets: true, enableBasicAutocompletion: true, enableLiveAutocompletion: true } }"></div></md-tab></md-tabs><handle></handle><preview id="preview" content="main.content"></preview></md-content></div>'),t.put("app/profile/profile.html",'<div layout="column" layout-fill=""><navbar><md-button ng-href="/editor" class="md-raised">New</md-button></navbar><md-content layout-padding=""><a ng-href="{{profile.user.html_url}}" layout="row" layout-align="space-around center"><img ng-src="{{profile.user.avatar_url}}" alt="{{profile.user.name}}" class="face face-2x"><div flex=""><h1>{{profile.user.name}}</h1><span>{{profile.user.bio}}</span></div></a><md-whiteframe class="md-whiteframe-z2" layout="" layout-align="center center"><md-grid-list md-cols-sm="1" md-cols-md="4" md-cols-gt-md="8" md-row-height-gt-md="1:1" md-row-height="2:2" md-gutter="36px" md-gutter-gt-sm="20px" flex="" ng-if="profile.gists.length > 0"><md-grid-tile md-rowspan="1" md-colspan="2" ng-repeat="gist in profile.gists" layout="row"><div><a ng-href="/editor/{{gist.id}}"><h3>{{gist.description}}</h3><small>last update in {{gist.updated_at | amDateFormat:\'MMMM Do YYYY, h:mm a\'}}</small></a><p ng-if="profile.isOwner(gist)"><md-button md-no-ink="" ng-click="profile.remove(gist.id)" class="md-warn">Delete</md-button></p></div></md-grid-tile></md-grid-list><h2 ng-if="profile.gists.length === 0" class="md-display-1">No Gists yet.</h2></md-whiteframe></md-content></div>'),t.put("components/navbar/navbar.html",'<md-toolbar><div class="md-toolbar-tools"><md-button href="/">Gistter</md-button><div layout="row" layout-align="start center" flex=""><div ng-transclude=""></div><span flex=""></span> <a ng-if="!navbar.Auth.isLogged()" href="https://github.com/login/oauth/authorize?client_id=6e6377a2f4543ef05194&scope=user:email,user:follow,gist" class="btn-github">Log in with Github</a><md-button ng-if="navbar.Auth.isLogged()" ng-href="/{{navbar.user.login}}/" layout="row" layout-align="end center"><img ng-src="{{navbar.user.avatar_url}}" alt="{{navbar.user.name}}" class="face"> <span>{{navbar.user.name}}</span></md-button></div></div></md-toolbar>')}]);